{"componentChunkName":"component---src-components-post-post-page-tsx","path":"/WebRTC-구현하기-1-N-SFU/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"1-서론\" style=\"position:relative;\"><a href=\"#1-%EC%84%9C%EB%A1%A0\" aria-label=\"1 서론 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 서론</h1>\n<p>지난 시간에는 <a href=\"https://millo-l.github.io/WebRTC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-1-N-P2P/\">WebRTC를 이용한 1:N P2P 통신</a>에 대해서 포스팅했다. SFU 방식에 대해 포스팅을 할까말까 고민을 했는 데 그래도 하는 게 낫지 않을까 싶어 이렇게 글을 남긴다. SFU는 Media Server의 한 종류로 그에 대한 설명은 <a href=\"https://millo-l.github.io/WebRTC-%EA%B5%AC%ED%98%84-%EB%B0%A9%EC%8B%9D(Mesh-SFU-MCU)/\">여기</a>를 눌러 지난 포스팅을 확인해보기 바란다. 미디어 서버는 <a href=\"https://www.kurento.org/\">Kurento</a>와 <a href=\"https://mediasoup.org/documentation/\">mediasoup</a> 등을 이용하여 상용화 단계에서 사용한다. 하지만 글쓴이는 이론을 바탕으로 미디어 서버, 그 중 SFU 서버를 구성해보고자 했다. 이론적인 설명은 기존의 포스팅에서 다뤘으니 위의 여기 링크를 눌러 확인해보기 바란다. 이론적인 바탕은 모두 안다고 가정하고 구현에 대한 포스팅을 작성해보겠다.</p>\n<h1 id=\"2-실제-코드\" style=\"position:relative;\"><a href=\"#2-%EC%8B%A4%EC%A0%9C-%EC%BD%94%EB%93%9C\" aria-label=\"2 실제 코드 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 실제 코드</h1>\n<h2 id=\"2-1-sfu-servernodejs\" style=\"position:relative;\"><a href=\"#2-1-sfu-servernodejs\" aria-label=\"2 1 sfu servernodejs permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. SFU Server(Node.js)</h2>\n<h3>주의할 점: socket.io version=2.3.0을 사용하셔야 합니다.</h3>\n<h3>1. 변수 설명</h3>\n<ul>\n<li>\n<p>receiverPCs</p>\n<ul>\n<li>\n<p>role</p>\n<ul>\n<li>접속한 user의 MediaStream을 받기 위한 RTCPeerConnection을 저장</li>\n</ul>\n</li>\n<li>\n<p>format</p>\n<ul>\n<li>receiverPCs[접속한 user의 socketID] = RTCPeerConnection 변수</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>senderPCs</p>\n<ul>\n<li>\n<p>role</p>\n<ul>\n<li>한 user에게 자신을 제외한 다른 user의 MediaStream을 보내기 위한 RTCPeerConnection을 저장</li>\n</ul>\n</li>\n<li>\n<p>format</p>\n<ul>\n<li>senderPCs[보내지는 MediaStream의 user socketID] = [{id: 받는 user의 socketID, pc: MediaStream을 보내기 위한 RTCPeerConnection}, ...]</li>\n<li>senderPCs[socketID] = Array&#x3C;{id: string, pc: RTCPeerConnection}></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>users</p>\n<ul>\n<li>\n<p>role</p>\n<ul>\n<li>receiverPCs에서 연결된 RTCPeerConnection을 통해 받은 MediaStream을 user의 socketID와 함께 저장</li>\n</ul>\n</li>\n<li>\n<p>format</p>\n<ul>\n<li>users[roomID] = [{id: MediaStream 보내는 user의 socketID, stream: user가 RTCPeerConnection을 통해 보내는 MedaiStream}]</li>\n<li>users[roomID] = Array&#x3C;{id: string, stream: MediaStream}></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>socketToRoom</p>\n<ul>\n<li>\n<p>role</p>\n<ul>\n<li>user가 어떤 room에 속해 있는 지 저장</li>\n</ul>\n</li>\n<li>\n<p>format</p>\n<ul>\n<li>socketToRoom[socketID] = user가 속해 있는 roomID</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> receiverPCs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> senderPCs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> users <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> socketToRoom <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3>2. socket 이벤트</h3>\n<ul>\n<li>\n<p>joinRoom</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>id: room에 들어온 user의 socket id</li>\n<li>room: room id</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>기존에 room에 들어와 자신의 MediaStream을 서버에게 전송하고 있는 user들의 socket id 목록을 지금 들어온 user에게 전송</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"joinRoom\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> allUsers <span class=\"token operator\">=</span> <span class=\"token function\">getOtherUsersInRoom</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">.</span>roomID<span class=\"token punctuation\">)</span>\n        io<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"allUsers\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> users<span class=\"token operator\">:</span> allUsers <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>senderOffer</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>senderSocketID: 자신의 MediaStream 데이터를 서버로 보내는 RTCPeerConnection의 offer를 보낸 user의 socket id</li>\n<li>roomID: user가 소속되고자 하는 roomID</li>\n<li>sdp: offer를 보내는 user의 RTCSessionDescription</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>user의 MediaStream을 받을 RTCPeerConnection의 offer를 서버가 받고 answer을 보냄</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4>주의할 점: createAnswer에서 offerToReceiveAudio, offerToReceiveVideo를 모두 true로 두는 것은 user로 부터 audio와 video stream을 모두 받아와야 하기 때문이다.</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"senderOffer\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        socketToRoom<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>roomID\n        <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token function\">createReceiverPeerConnection</span><span class=\"token punctuation\">(</span>\n            data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">,</span>\n            socket<span class=\"token punctuation\">,</span>\n            data<span class=\"token punctuation\">.</span>roomID\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>sdp<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> sdp <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">createAnswer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            offerToReceiveAudio<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            offerToReceiveVideo<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span>sdp<span class=\"token punctuation\">)</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>roomID<span class=\"token punctuation\">)</span>\n        io<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getSenderAnswer\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> sdp <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>senderCandidate</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>senderSocketID: 자신의 MediaStream 데이터를 서버로 보내는 RTCPeerConnection의 candidate를 보낸 user의 socket id</li>\n<li>candidate: user의 RTCIceCandidate</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 user가 offer를 보낼 때 저장해놓은 RTCPeerConnection에 RTCIceCandidate를 추가</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"senderCandidate\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> receiverPCs<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">wrtc<span class=\"token punctuation\">.</span>RTCIceCandidate</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>receiverOffer</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>receiverSocketID: senderSocketID를 socket id로 가지는 user의 MediaStream을 받기 위한 RTCPeerConnection의 offer를 보낸 user의 socket id</li>\n<li>senderSocketID: 서버로 자신의 MediaStream을 보내기 위한 RTCPeerConnection이 연결되어 있는 user의 socket id</li>\n<li>roomID: receiverSocketID와 senderSocketID가 모두 소속된 room ID</li>\n<li>sdp: offer를 보내는 user의 RTCSessionDescription</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>receiverSocketID를 socket id로 가지는 user가 senderSocketID를 socket id로 가지는 user의 MediaStream을 받기 위한 RTCPeerConnection의 offer를 서버가 받고 answer을 보냄</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4>주의할 점: createAnswer에서 offerToReceiveAudio, offerToReceiveVideo를 모두 false로 두는 것은 user로 부터 audio와 video stream을 받지 않기 때문이다. (지금 생성한 RTCPeerConnection은 기존에 있던 user의 stream을 보내기 위한 연결이다.)</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"receiverOffer\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token function\">createSenderPeerConnection</span><span class=\"token punctuation\">(</span>\n            data<span class=\"token punctuation\">.</span>receiverSocketID<span class=\"token punctuation\">,</span>\n            data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">,</span>\n            socket<span class=\"token punctuation\">,</span>\n            data<span class=\"token punctuation\">.</span>roomID\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>sdp<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> sdp <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">createAnswer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            offerToReceiveAudio<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            offerToReceiveVideo<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span>sdp<span class=\"token punctuation\">)</span>\n        io<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>receiverSocketID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getReceiverAnswer\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">,</span>\n            sdp<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>receiverCandidate</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>receiverSocketID: senderSocketID를 socket id로 가지는 user의 MediaStream을 받기 위한 RTCPeerConnection의 offer를 보낸 user의 socket id</li>\n<li>senderSocketID: 서버로 자신의 MediaStream을 보내기 위한 RTCPeerConnection이 연결되어 있는 user의 socket id</li>\n<li>candidate: receiverSocketID를 socket id로 가지는 user의 RTCIceCandidate</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>receiverSocketID를 socket id로 가지는 user가 offer를 보낼 때 저장해놓은 RTCPeerConnection에 RTCIceCandidate를 추가</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"receiverCandidate\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> senderPC <span class=\"token operator\">=</span> senderPCs<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>senderSocketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n            <span class=\"token parameter\">sPC</span> <span class=\"token operator\">=></span> sPC<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> data<span class=\"token punctuation\">.</span>receiverSocketID\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> senderPC<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>pc<span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">wrtc<span class=\"token punctuation\">.</span>RTCIceCandidate</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>disconnect</p>\n<ul>\n<li>\n<p>role</p>\n<ul>\n<li>disconnect된 user와 연결되어 있는 모든 RTCPeerConnection 및 MedaiStream을 해제</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"disconnect\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> roomID <span class=\"token operator\">=</span> socketToRoom<span class=\"token punctuation\">[</span>socket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span>\n\n        <span class=\"token function\">deleteUser</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> roomID<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">closeRecevierPC</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">closeSenderPCs</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n\n        socket<span class=\"token punctuation\">.</span>broadcast<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>roomID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userExit\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> socket<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>3. 함수 설명</h3>\n<ul>\n<li>\n<p>isIncluded</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>array: 배열</li>\n<li>id: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>배열 내의 Dictionary 중 id가 일치하는 것이 존재하는 지 여부 반환</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isIncluded</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">array<span class=\"token punctuation\">,</span> id</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> array<span class=\"token punctuation\">.</span>length\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>createReceiverPeerConnection</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>socketID: string</li>\n<li>socket: socketio.Socket</li>\n<li>roomID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>user의 socketID를 key로 한 receiverPCs의 value로 새로 생성한 pc를 저장하고 그 pc를 통해 user의 MediaStream을 전달받는 이벤트 생성</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createReceiverPeerConnection</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">socketID<span class=\"token punctuation\">,</span> socket<span class=\"token punctuation\">,</span> roomID</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">wrtc<span class=\"token punctuation\">.</span>RTCPeerConnection</span><span class=\"token punctuation\">(</span>pc_config<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>receiverPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> receiverPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pc\n    <span class=\"token keyword\">else</span> receiverPCs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>receiverPCs<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> pc <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onicecandidate</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//console.log(`socketID: ${socketID}'s receiverPeerConnection icecandidate`);</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>socketID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getSenderCandidate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            candidate<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">oniceconnectionstatechange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//console.log(e);</span>\n    <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">ontrack</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isIncluded</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> socketID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    id<span class=\"token operator\">:</span> socketID<span class=\"token punctuation\">,</span>\n                    stream<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>streams<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    id<span class=\"token operator\">:</span> socketID<span class=\"token punctuation\">,</span>\n                    stream<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>streams<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n        socket<span class=\"token punctuation\">.</span>broadcast<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>roomID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userEnter\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> socketID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> pc\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>createSenderPeerConnection</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>receiverSocketID: string</li>\n<li>senderSocketID: string</li>\n<li>socket: socketio.Socket</li>\n<li>roomID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>senderSocketID를 socket id로 가진 user의 MediaStream을 receiverSockerID를 socket id 로 가진 user에게 전달하기 위한 RTCPeerConnection을 생성하고 해당 RTCPeerConnection에 senderSocketID user의 videotrack, audiotrack을 추가한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSenderPeerConnection</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">receiverSocketID<span class=\"token punctuation\">,</span>\n    senderSocketID<span class=\"token punctuation\">,</span>\n    socket<span class=\"token punctuation\">,</span>\n    roomID</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">wrtc<span class=\"token punctuation\">.</span>RTCPeerConnection</span><span class=\"token punctuation\">(</span>pc_config<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>senderPCs<span class=\"token punctuation\">[</span>senderSocketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        senderPCs<span class=\"token punctuation\">[</span>senderSocketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> receiverSocketID<span class=\"token punctuation\">)</span>\n        senderPCs<span class=\"token punctuation\">[</span>senderSocketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> receiverSocketID<span class=\"token punctuation\">,</span> pc<span class=\"token operator\">:</span> pc <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span>\n        senderPCs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token operator\">...</span>senderPCs<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span>senderSocketID<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> receiverSocketID<span class=\"token punctuation\">,</span> pc<span class=\"token operator\">:</span> pc <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onicecandidate</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//console.log(`socketID: ${receiverSocketID}'s senderPeerConnection icecandidate`);</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>receiverSocketID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getReceiverCandidate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> senderSocketID<span class=\"token punctuation\">,</span>\n            candidate<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">oniceconnectionstatechange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//console.log(e);</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> sendUser <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> senderSocketID<span class=\"token punctuation\">)</span>\n    sendUser<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">.</span><span class=\"token function\">getTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        pc<span class=\"token punctuation\">.</span><span class=\"token function\">addTrack</span><span class=\"token punctuation\">(</span>track<span class=\"token punctuation\">,</span> sendUser<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> pc\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>getOtherUsersInRoom</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>socketID: string</li>\n<li>roomID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>자신을 제외하고 room ID에 포함된 모든 유저의 socket id 배열을 반환</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getOtherUsersInRoom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">socketID<span class=\"token punctuation\">,</span> roomID</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> allUsers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> allUsers\n\n    <span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> socketID<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n        allUsers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> allUsers\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>deleteUser</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>socketID: string</li>\n<li>roomID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>user의 정보가 포함된 목록에서 user를 제거한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">deleteUser</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">socketID<span class=\"token punctuation\">,</span> roomID</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> roomUsers <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>roomUsers<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n    roomUsers <span class=\"token operator\">=</span> roomUsers<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> socketID<span class=\"token punctuation\">)</span>\n    users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> roomUsers\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>roomUsers<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">delete</span> users<span class=\"token punctuation\">[</span>roomID<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">delete</span> socketToRoom<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>closeReceiverPC</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>socketID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>socketID user가 자신의 MediaStream을 보내기 위해 연결한 RTCPeerConnection을 닫고, 목록에서 삭제한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">closeRecevierPC</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">socketID</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>receiverPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n    receiverPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">delete</span> receiverPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>closeSenderPCs</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>socketID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>socketID user의 MediaStream을 다른 user에게 전송하기 위해 연결 중이던 모든 RTCPeerConnection을 닫고, 목록에서 삭제한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">closeSenderPCs</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">socketID</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>senderPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n    <span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> senderPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        senderPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>pc<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> _senderPCs <span class=\"token operator\">=</span> senderPCs<span class=\"token punctuation\">[</span>senderPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">let</span> senderPC <span class=\"token operator\">=</span> _senderPCs<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">sPC</span> <span class=\"token operator\">=></span> sPC<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> socketID<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>senderPC<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            senderPC<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>pc<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            senderPCs<span class=\"token punctuation\">[</span>senderPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> _senderPCs<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n                <span class=\"token parameter\">sPC</span> <span class=\"token operator\">=></span> sPC<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> socketID\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">delete</span> senderPCs<span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"2-2-clientreactjs-typescript\" style=\"position:relative;\"><a href=\"#2-2-clientreactjs-typescript\" aria-label=\"2 2 clientreactjs typescript permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. Client(ReactJS, Typescript)</h2>\n<h3>주의할 점: socket.io-client version=2.3.0, @types/socket.io-client version=1.4.34을 사용하셔야 합니다.</h3>\n<h3>1. 변수 설명</h3>\n<ul>\n<li>socket: 서버와 통신할 소켓 (SocketIOClient.Socket)</li>\n<li>users: 상대방의 데이터(socket id, MediaStream) 배열</li>\n<li>localVideoRef: 자신의 MediaStream을 출력할 video 태그의 ref</li>\n<li>sendPC: 자신의 MediaStream을 서버에게 전송할 RTCPeerConnection</li>\n<li>receivePCs: 같은 room에 참가한 다른 user들의 MediaStream을 서버에서 전송받을 RTCPeerConnection 목록 (receivePCs[socket id] = pc 형식)</li>\n<li>pc_config: RTCPeerConnection 생성 시의 setting</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>socket<span class=\"token punctuation\">,</span> setSocket<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SocketIOClient<span class=\"token punctuation\">.</span>Socket<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>users<span class=\"token punctuation\">,</span> setUsers<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>IWebRTCUser<span class=\"token operator\">>></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> localVideoRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLVideoElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> sendPC<span class=\"token operator\">:</span> RTCPeerConnection\n<span class=\"token keyword\">let</span> receivePCs<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span>\n\n<span class=\"token keyword\">const</span> pc_config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    iceServers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// {</span>\n        <span class=\"token comment\">//   urls: 'stun:[STUN_IP]:[PORT]',</span>\n        <span class=\"token comment\">//   'credentials': '[YOR CREDENTIALS]',</span>\n        <span class=\"token comment\">//   'username': '[USERNAME]'</span>\n        <span class=\"token comment\">// },</span>\n        <span class=\"token punctuation\">{</span>\n            urls<span class=\"token operator\">:</span> <span class=\"token string\">\"stun:stun.l.google.com:19302\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>2. Socket 수신 이벤트</h3>\n<ul>\n<li>\n<p>userEnter</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>id: 같은 room에 참가하고 자신의 MediaStream을 전송할 RTCPeerConnection을 서버와 연결한 user의 socket id</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 user의 MediaStream을 받을 RTCPeerConnection을 생성하고 서버로 offer를 보냄</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userEnter\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> string <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createReceivePC</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> newSocket<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>allUsers</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>users: 기존에 방에 참가해서 자신의 MediaStream을 전송할 RTCPeerConnection을 서버와 연결한 user들의 socket id 배열</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 user들의 MediaStream을 받을 RTCPeerConnection을 생성하고 서버로 offer를 보냄</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"allUsers\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> users<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> string <span class=\"token punctuation\">}</span><span class=\"token operator\">></span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">.</span>length\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">createReceivePC</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> newSocket<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>userExit</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>id: disconnect된 user의 socket id</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 user의 MediaStream을 받기 위해 연결한 RTCPeerConnection을 닫고, 목록에서 삭제</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userExit\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> string <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    receivePCs<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">delete</span> receivePCs<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span>\n    <span class=\"token function\">setUsers</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">users</span> <span class=\"token operator\">=></span> users<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>getSenderAnswer</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>sdp: 자신의 MediaStream을 서버로 보내기 위해 offer를 보낸 RTCPeerConnection에 대한 answer로 온 RTCSessionDescription</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 RTCPeerConnection의 remoteDescription으로 sdp를 지정</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"getSenderAnswer\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> sdp<span class=\"token operator\">:</span> RTCSessionDescription <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">await</span> sendPC<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCSessionDescription</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>sdp<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>getSenderCandidate</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>candidate: 자신의 MediaStream을 서버로 보내기 위한 RTCPeerConnection을 위해 서버에서 보낸 RTCIceCandidate</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 RTCPeerConneciton에 RTCIceCandidate 추가</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"getSenderCandidate\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> candidate<span class=\"token operator\">:</span> RTCIceCandidateInit <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n            sendPC<span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCIceCandidate</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>getReceiverAnswer</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>id: 전송받을 MediaStream의 주인인 user의 socket id</li>\n<li>sdp: 전송받을 MediaStream의 RTCPeerConenction의 offer에 대한 answer로 온 RTCSessionDescription</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 RTCPeerConnection의 remoteDescription으로 sdp를 지정</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"getReceiverAnswer\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span> sdp<span class=\"token operator\">:</span> RTCSessionDescription <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> pc<span class=\"token operator\">:</span> RTCPeerConnection <span class=\"token operator\">=</span> receivePCs<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>sdp<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>\n<p>getReceiverCandidate</p>\n<ul>\n<li>\n<p>data</p>\n<ul>\n<li>id: 전송받을 MediaStream의 주인인 user의 socket id</li>\n<li>candidate: 전송받을 MediaStream의 RTCPeerConenction을 위해 서버에서 보낸 RTCIceCandidate</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>해당 RTCPeerConneciton에 RTCIceCandidate 추가</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"getReceiverCandidate\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span> candidate<span class=\"token operator\">:</span> RTCIceCandidateInit <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> pc<span class=\"token operator\">:</span> RTCPeerConnection <span class=\"token operator\">=</span> receivePCs<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n            pc<span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCIceCandidate</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>3. MediaStream 설정</h3>\n<ul>\n<li>navigator.mediaDevices.getUserMedia() 함수를 호출해서 자신의 MediaStream을 얻고 localVideoRef에 등록한다.</li>\n<li>자신의 MediaStream을 전송할 RTCPeerConnection을 생성하고 서버에게 offer를 보낸다.</li>\n<li>자신이 room에 참가했다고 서버에 알린다. (이후에 allUsers socket 이벤트로 답이 온다.)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">navigator<span class=\"token punctuation\">.</span>mediaDevices\n    <span class=\"token punctuation\">.</span><span class=\"token function\">getUserMedia</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        audio<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        video<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            width<span class=\"token operator\">:</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span>\n            height<span class=\"token operator\">:</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>localVideoRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> localVideoRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> stream\n\n        localStream <span class=\"token operator\">=</span> stream\n\n        sendPC <span class=\"token operator\">=</span> <span class=\"token function\">createSenderPeerConnection</span><span class=\"token punctuation\">(</span>newSocket<span class=\"token punctuation\">,</span> localStream<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">createSenderOffer</span><span class=\"token punctuation\">(</span>newSocket<span class=\"token punctuation\">)</span>\n\n        newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"joinRoom\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> newSocket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n            roomID<span class=\"token operator\">:</span> <span class=\"token string\">\"1234\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">getUserMedia error: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>4. 함수 설명</h3>\n<ul>\n<li>\n<p>createReceivePC</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>id: string</li>\n<li>newSocket: SocketIOClient.Socket</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>room에 참가한 다른 user들의 MediaStream을 받을 RTCPeerConnection을 생성하고 서버에 offer를 보냄</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createReceivePC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> newSocket<span class=\"token operator\">:</span> SocketIOClient<span class=\"token punctuation\">.</span>Socket</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token function\">createReceiverPeerConnection</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> newSocket<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">createReceiverOffer</span><span class=\"token punctuation\">(</span>pc<span class=\"token punctuation\">,</span> newSocket<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>createSenderOffer</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>newSocket: SocketIOClient.Socket</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>자신의 MediaStream을 서버에게 보낼 RTCPeerConnection의 offer를 생성</li>\n<li>RTCSessionDescription을 해당 RTCPeerConnection의 localDescription에 지정</li>\n<li>RTCSessionDescription을 소켓을 통해 서버로 전송</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4>주의할 점: 자신의 MediaStream을 보내기 위한 RTCPeerConnection이므로 offerToReceiveAudio, offerToReceiveVideo는 모두 false로 둔다.</h4>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSenderOffer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">newSocket<span class=\"token operator\">:</span> SocketIOClient<span class=\"token punctuation\">.</span>Socket</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> sdp <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> sendPC<span class=\"token punctuation\">.</span><span class=\"token function\">createOffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            offerToReceiveAudio<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            offerToReceiveVideo<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> sendPC<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCSessionDescription</span><span class=\"token punctuation\">(</span>sdp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"senderOffer\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            sdp<span class=\"token punctuation\">,</span>\n            senderSocketID<span class=\"token operator\">:</span> newSocket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n            roomID<span class=\"token operator\">:</span> <span class=\"token string\">\"1234\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>createReceiverOffer</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>pc: RTCPeerConnection</li>\n<li>newSocket: SocketIOClient.Socket</li>\n<li>senderSocketID: string</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>senderSocketID user의 MediaStream을 전송받을 RTCPeerConnection의 offer를 생성</li>\n<li>RTCSessionDescription을 해당 RTCPeerConnection의 localDescription에 지정</li>\n<li>RTCSessionDescription을 소켓을 통해 서버로 전송</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4>주의할 점: 다른 user의 MediaStream을 받기 위한 RTCPeerConnection이므로 offerToReceiveAudio, offerToReceiveVideo는 모두 true로 둬야한다.</h4>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createReceiverOffer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">pc<span class=\"token operator\">:</span> RTCPeerConnection<span class=\"token punctuation\">,</span>\n    newSocket<span class=\"token operator\">:</span> SocketIOClient<span class=\"token punctuation\">.</span>Socket<span class=\"token punctuation\">,</span>\n    senderSocketID<span class=\"token operator\">:</span> string</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> sdp <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">createOffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            offerToReceiveAudio<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            offerToReceiveVideo<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">await</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCSessionDescription</span><span class=\"token punctuation\">(</span>sdp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"receiverOffer\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            sdp<span class=\"token punctuation\">,</span>\n            receiverSocketID<span class=\"token operator\">:</span> newSocket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n            senderSocketID<span class=\"token punctuation\">,</span>\n            roomID<span class=\"token operator\">:</span> <span class=\"token string\">\"1234\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>createSenderPeerConnection</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>newSocket: SocketIOClient.Socket</li>\n<li>localStream: MediaStream</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>자신의 MediaStream을 서버로 보내기 위한 RTCPeerConnection을 생성하고 localStream을 등록</li>\n<li>\n<p>onicecandidate</p>\n<ul>\n<li>offer 또는 answer signal을 생성한 후부터 본인의 RTCIceCandidate 정보 이벤트가 발생</li>\n<li>본인의 RTCIceCandidate 정보를 Socket을 통해 서버로 전송</li>\n</ul>\n</li>\n<li>\n<p>oniceconnectionstatechange</p>\n<ul>\n<li>ICE connection 상태가 변경됐을 때의 log</li>\n</ul>\n</li>\n<li>생성된 RTCPeerConnection 반환</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> createSenderPeerConnection <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    newSocket<span class=\"token operator\">:</span> SocketIOClient<span class=\"token punctuation\">.</span>Socket<span class=\"token punctuation\">,</span>\n    localStream<span class=\"token operator\">:</span> MediaStream\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token parameter\">RTCPeerConnection</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCPeerConnection</span><span class=\"token punctuation\">(</span>pc_config<span class=\"token punctuation\">)</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onicecandidate</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"senderCandidate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                candidate<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">,</span>\n                senderSocketID<span class=\"token operator\">:</span> newSocket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">oniceconnectionstatechange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>localStream<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localstream add\"</span><span class=\"token punctuation\">)</span>\n        localStream<span class=\"token punctuation\">.</span><span class=\"token function\">getTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            pc<span class=\"token punctuation\">.</span><span class=\"token function\">addTrack</span><span class=\"token punctuation\">(</span>track<span class=\"token punctuation\">,</span> localStream<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no local stream\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// return pc</span>\n    <span class=\"token keyword\">return</span> pc\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>createReceiverPeerConnection</p>\n<ul>\n<li>\n<p>parameter</p>\n<ul>\n<li>socketID: string</li>\n<li>newSocket: SocketIOClient.Socket</li>\n</ul>\n</li>\n<li>\n<p>role</p>\n<ul>\n<li>socketID user의 MediaStream을 받기 위한 RTCPeerConnection 생성</li>\n<li>receivePCs 변수에 key-value 형식으로 생성한 RTCPeerConnection 저장</li>\n<li>\n<p>onicecandidate</p>\n<ul>\n<li>offer 또는 answer signal을 생성한 후부터 본인의 RTCIceCandidate 정보 이벤트가 발생</li>\n<li>본인의 RTCIceCandidate 정보를 Socket을 통해 서버로 전송</li>\n</ul>\n</li>\n<li>\n<p>oniceconnectionstatechange</p>\n<ul>\n<li>ICE connection 상태가 변경됐을 때의 log</li>\n</ul>\n</li>\n<li>\n<p>ontrack</p>\n<ul>\n<li>상대방의 RTCSessionDescription을 본인의 RTCPeerConnection에서의 remoteSessionDescription으로 지정하면 상대방의 track 데이터에 대한 이벤트가 발생</li>\n<li>users 변수에 stream을 등록</li>\n</ul>\n</li>\n<li>생성된 RTCPeerConnection 반환</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> createReceiverPeerConnection <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    socketID<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    newSocket<span class=\"token operator\">:</span> SocketIOClient<span class=\"token punctuation\">.</span>Socket\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token parameter\">RTCPeerConnection</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> pc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCPeerConnection</span><span class=\"token punctuation\">(</span>pc_config<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// add pc to peerConnections object</span>\n    receivePCs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>receivePCs<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>socketID<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> pc <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onicecandidate</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            newSocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"receiverCandidate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                candidate<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">,</span>\n                receiverSocketID<span class=\"token operator\">:</span> newSocket<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n                senderSocketID<span class=\"token operator\">:</span> socketID<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">oniceconnectionstatechange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    pc<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">ontrack</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setUsers</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldUsers</span> <span class=\"token operator\">=></span> oldUsers<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> user<span class=\"token punctuation\">.</span>id <span class=\"token operator\">!==</span> socketID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">setUsers</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldUsers</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n            <span class=\"token operator\">...</span>oldUsers<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                id<span class=\"token operator\">:</span> socketID<span class=\"token punctuation\">,</span>\n                stream<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>streams<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// return pc</span>\n    <span class=\"token keyword\">return</span> pc\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>5. 본인과 상대방의 video 렌더링</h3>\n<ul>\n<li>IWebRTCUser: users 저장에 사용했던 인터페이스</li>\n<li>Props: Video 태그에 사용되는 props</li>\n<li>Video: 상대방의 video를 출력할 컴포넌트</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">IWebRTCUser</span> <span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n    email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n    stream<span class=\"token operator\">:</span> MediaStream\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Props</span> <span class=\"token punctuation\">{</span>\n    email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n    stream<span class=\"token operator\">:</span> MediaStream\n    muted<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Video</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> email<span class=\"token punctuation\">,</span> stream<span class=\"token punctuation\">,</span> muted <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> Props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ref <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLVideoElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isMuted<span class=\"token punctuation\">,</span> setIsMuted<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">boolean</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> ref<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> stream\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>muted<span class=\"token punctuation\">)</span> <span class=\"token function\">setIsMuted</span><span class=\"token punctuation\">(</span>muted<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Container</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">VideoContainer</span></span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>ref<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">muted</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isMuted<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">autoPlay</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">VideoContainer</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserLabel</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>email<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">UserLabel</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Container</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span>\n            <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n                width<span class=\"token operator\">:</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span>\n                height<span class=\"token operator\">:</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span>\n                margin<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n                backgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">\"black\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n            <span class=\"token attr-name\">muted</span>\n            <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>localVideoRef<span class=\"token punctuation\">}</span></span>\n            <span class=\"token attr-name\">autoPlay</span>\n        <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>video</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token punctuation\">{</span>users<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Video</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">email</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">stream</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h1 id=\"3-느낀-점\" style=\"position:relative;\"><a href=\"#3-%EB%8A%90%EB%82%80-%EC%A0%90\" aria-label=\"3 느낀 점 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 느낀 점</h1>\n<p>미디어 서버를 처음으로 개발해보니 생각보다 부하가 엄청나다는 걸 처음 알았다. 물론 테스트 자체를 Client와 Server가 나의 한 PC에서 실행되다 보니 부하가 기하급수적으로 증가하는 걸 알고는 있지만, 미디어 서버를 구현하려면 돈이 많아야 되구나.. 라는 걸 다시금 느꼈다. 처음부터 SFU 서버까지 구현해보리라 생각하고 시작한 포스팅은 아니었지만 구현하다보니 이것저것 호기심이 생겨서 더더 해보자 하다보니 이렇게 구현하게 됐다. 구현 중 큰 어려움은 없었지만 createOffer, createAnswer 시에 offerToReceiveAudio, offerToReceiveVideo 속성에 대한 잘못된 이해로 고생을 좀 했다. 다른 사람들은 이런 고생을 안 했으면 좋겠단 마음으로 주의할 점에 꼼꼼히 기록해놨다. MCU 서버를 구현해볼지 안 할지는 사실 잘 모르겠다. 해보고 싶긴 한데 시간이 날지가 의문이기 때문에... 혹여나 누군가 요청한다면 도전해볼 의향은 있다. 다만, 미디어 서버 자체를 상용화해서 사용하는 경우에는 위의 서론에서 말한대로 <a href=\"https://www.kurento.org/\">Kurento</a>나 <a href=\"https://mediasoup.org/documentation/\">mediasoup</a> 등을 이용하는 것으로 알고 있으므로 직접 개발하는 것이 목적이 아닌 상용화가 목적이라면 저 두 사이트를 방문해서 공식문서를 기반으로 개발하기를 권장한다.</p>\n<h1 id=\"github\" style=\"position:relative;\"><a href=\"#github\" aria-label=\"github permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[GitHub]</h1>\n<ul>\n<li><a href=\"https://github.com/millo-L/Typescript-ReactJS-WebRTC-1-N-SFU\">https://github.com/millo-L/Typescript-ReactJS-WebRTC-1-N-SFU</a></li>\n</ul>\n<h1 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[참고]</h1>\n<ul>\n<li><a href=\"https://millo-l.github.io/WebRTC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-1-N-P2P/\">https://millo-l.github.io/WebRTC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-1-N-P2P/</a></li>\n<li><a href=\"https://millo-l.github.io/WebRTC-%EA%B5%AC%ED%98%84-%EB%B0%A9%EC%8B%9D(Mesh-SFU-MCU)/\">https://millo-l.github.io/WebRTC-%EA%B5%AC%ED%98%84-%EB%B0%A9%EC%8B%9D(Mesh-SFU-MCU)/</a></li>\n</ul>","id":"fc7c5727-4d45-5d36-aefb-e4f09659f08d","tableOfContents":"<ul>\n<li><a href=\"#1-%EC%84%9C%EB%A1%A0\">1. 서론</a></li>\n<li>\n<p><a href=\"#2-%EC%8B%A4%EC%A0%9C-%EC%BD%94%EB%93%9C\">2. 실제 코드</a></p>\n<ul>\n<li><a href=\"#2-1-sfu-servernodejs\">2-1. SFU Server(Node.js)</a></li>\n<li><a href=\"#2-2-clientreactjs-typescript\">2-2. Client(ReactJS, Typescript)</a></li>\n</ul>\n</li>\n<li><a href=\"#3-%EB%8A%90%EB%82%80-%EC%A0%90\">3. 느낀 점</a></li>\n<li><a href=\"#github\">GitHub</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n</ul>","frontmatter":{"author":"millo","description":"WebRTC의 이론을 기반으로 1:N SFU 미디어 서버를 만들어 실시간 영상 송수신을 구현해보자.","category":"webrtc","released_at":"2021-01-15","updated_at":null,"tags":["WebRTC","SFU","Media Server","nodejs","reactjs","typescript"],"title":"WebRTC 구현하기(1:N SFU)","lang":"ko","series":"WebRTC 이론부터 실전까지","translation":"/Implementing-WebRTC-using-ReactJS-and-Typescript(1-N-SFU)/","image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABI0lEQVQoz41Sz0uEQBT2L5S6dxeCLh26eZIMoj2W5iUPUpJCwgaFoLCVhIgoRuytWyAdOiWyOeOX4zLbrsWyH7xf8948vnlvBHRo2xaU0oWwmJ91Zm4p6Xy6UrcsvI/A1Fq0FJuA9xGYqusaWZZhMpkgSRJUVYWyLPH6UvRF07GPr+sLfHy+4+rShu/7ME0TQRDAcRwUxbyOMRU4XVVVIYoiJEmCLMs4VI+wv7eL05t7jB/eQKbnuLs9wNb2DnT9DJZlQVEUeJ7Xk1k8mRDSB2EYwnVd2LYNwzD6CyejEdLnCN+Zi+NCR5A/IvQDPEUR0jRFnufQNA1xHP8y5M7a+TQzkKbZbIbc4dtijIcb5Guj7epPWPb/bJl/laEMc6z7fzmOH+JoUHn0gycpAAAAAElFTkSuQmCC","aspectRatio":2.4691358024691357,"src":"/static/5d1a4dc7a92facc014378e28932bee9a/8a558/webrtc.png","srcSet":"/static/5d1a4dc7a92facc014378e28932bee9a/69585/webrtc.png 200w,\n/static/5d1a4dc7a92facc014378e28932bee9a/497c6/webrtc.png 400w,\n/static/5d1a4dc7a92facc014378e28932bee9a/8a558/webrtc.png 539w","sizes":"(max-width: 539px) 100vw, 539px"}}}},"fields":{"slug":"/WebRTC-구현하기-1-N-SFU/"}},"site":{"siteMetadata":{"siteUrl":"https://millo-L.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"WebRTC 이론 정리하기","lang":"ko"},"fields":{"slug":"/WebRTC-이론-정리하기/"}}},{"node":{"frontmatter":{"title":"WebRTC 구현 방식(Mesh/P2P, SFU, MCU)","lang":"ko"},"fields":{"slug":"/WebRTC-구현-방식(Mesh-SFU-MCU)/"}}},{"node":{"frontmatter":{"title":"WebRTC 구현하기(1:1 P2P)","lang":"ko"},"fields":{"slug":"/WebRTC-구현하기-1-1-P2P/"}}},{"node":{"frontmatter":{"title":"WebRTC 구현하기(1:N P2P)","lang":"ko"},"fields":{"slug":"/WebRTC-구현하기-1-N-P2P/"}}},{"node":{"frontmatter":{"title":"WebRTC 구현하기(1:N SFU)","lang":"ko"},"fields":{"slug":"/WebRTC-구현하기-1-N-SFU/"}}},{"node":{"frontmatter":{"title":"WebRTC 성능 비교(P2P vs SFU)","lang":"ko"},"fields":{"slug":"/WebRTC-성능비교-P2P-vs-SFU/"}}}]}},"pageContext":{"slug":"/WebRTC-구현하기-1-N-SFU/","series":"WebRTC 이론부터 실전까지"}},"staticQueryHashes":["1608878238","3469517283","764694655"]}