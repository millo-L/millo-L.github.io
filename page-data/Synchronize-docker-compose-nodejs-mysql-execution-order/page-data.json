{"componentChunkName":"component---src-components-post-post-page-tsx","path":"/Synchronize-docker-compose-nodejs-mysql-execution-order/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"1-introduction\" style=\"position:relative;\"><a href=\"#1-introduction\" aria-label=\"1 introduction permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Introduction</h1>\n<p>In most cases, a stable DB environment is established using AWS' RDS or workstation internal DB, but Docker is available when implementing DB for testing purposes or simple projects. Some people say MySQL's data is not stable, but the problem can be solved by connecting volumes. However, if you connect node.js server and mysql with docker-compose, you can see that there is a connection error. The problem is that mysql runs slower than node.js servers. This requires synchronizing node.js to run slower than mysql.</p>\n<p><span style=\"color:red\">In this posting, node.js and mysql are examples, but can be applied to both servers in different languages and DBs in different languages.</span></p>\n<h1 id=\"2-folder-structure\" style=\"position:relative;\"><a href=\"#2-folder-structure\" aria-label=\"2 folder structure permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Folder Structure</h1>\n<p>As mentioned above, the /sync-docker/db/data folder is a folder that shares the data volume of the mysql docker. Therefore, the information is preserved even if the docker is re-run. In addition, by creating init.sql of the /sync-docker/db/init folder and sharing the volume with mysql docker, the initial DB and tables can be created on a fresh start.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ğŸ“¦sync-docker\n â”£ ğŸ“‚db\n â”ƒ â”£ ğŸ“‚data\n â”ƒ â”£ ğŸ“‚init\n â”ƒ â”ƒ â”— ğŸ“œinit.sql\n â”ƒ â”— ğŸ“œ.gitignore\n â”£ ğŸ“‚server\n â”ƒ â”£ ğŸ“‚node_modules\n â”ƒ â”£ ğŸ“œ.dockerignore\n â”ƒ â”£ ğŸ“œ.gitignore\n â”ƒ â”£ ğŸ“œdocker-entrypoint.sh\n â”ƒ â”£ ğŸ“œDockerfile\n â”ƒ â”£ ğŸ“œindex.js\n â”ƒ â”£ ğŸ“œpackage-lock.json\n â”ƒ â”— ğŸ“œpackage.json\n â”— ğŸ“œdocker-compose.yml</code></pre></div>\n<h1 id=\"3-docker-composeyml\" style=\"position:relative;\"><a href=\"#3-docker-composeyml\" aria-label=\"3 docker composeyml permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. docker-compose.yml</h1>\n<p>First of all, it is essential to create a docker's network to connect the network between containers that are running. This part is explained for a long time, so I'll assume that you know. You can also name the db container in the depends_on portion of the server container and name the network created in the network portion. (where we named the db container 'db')</p>\n<p>In the db container, the folder /init and /data mentioned above is associated with the folder inside the db container in the volume section. (For data retention and initialization) In addition, the command section specifies the DB's character scheme as utf8.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># docker-compose.yml</span>\n\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.5\"</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> ./server\n        <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> 8080<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span>\n        <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> db<span class=\"token punctuation\">-</span>net\n        <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> db\n    <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span>8.0.20\n        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> mysqld <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>default<span class=\"token punctuation\">-</span>authentication<span class=\"token punctuation\">-</span>plugin=mysql_native_password <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>character<span class=\"token punctuation\">-</span>set<span class=\"token punctuation\">-</span>server=utf8mb4 <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>collation<span class=\"token punctuation\">-</span>server=utf8mb4_unicode_ci\n        <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n        <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./db/init<span class=\"token punctuation\">:</span>/docker<span class=\"token punctuation\">-</span>entrypoint<span class=\"token punctuation\">-</span>initdb.d\n            <span class=\"token punctuation\">-</span> ./db/data<span class=\"token punctuation\">:</span>/var/lib/mysql\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root\n        <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> db<span class=\"token punctuation\">-</span>net\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> 8086<span class=\"token punctuation\">:</span><span class=\"token number\">3306</span>\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n    db<span class=\"token punctuation\">-</span>net<span class=\"token punctuation\">:</span></code></pre></div>\n<h1 id=\"4-nodejs\" style=\"position:relative;\"><a href=\"#4-nodejs\" aria-label=\"4 nodejs permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. node.js</h1>\n<p>By default, the /node_modules folder, package-lock.json, package.json, and .gitignore files are always present in node.js, so we will omit the description.</p>\n<h2 id=\"4-1-dockerfile\" style=\"position:relative;\"><a href=\"#4-1-dockerfile\" aria-label=\"4 1 dockerfile permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-1. Dockerfile</h2>\n<p>In the Dockerfile below, a module called <strong>dockerize</strong> is installed, which performs the function of synchronizing the run order between docker containers in docker-compose. After installation, the docker-entrypoint.sh file is run from the container to synchronize the execution sequence.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Dockerfile for node.js</span>\n\n<span class=\"token keyword\">FROM</span> node<span class=\"token punctuation\">:</span>12.18.0\n\n<span class=\"token keyword\">ENV</span> DOCKERIZE_VERSION v0.2.0\n<span class=\"token keyword\">RUN</span> wget https<span class=\"token punctuation\">:</span>//github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize<span class=\"token punctuation\">-</span>linux<span class=\"token punctuation\">-</span>amd64<span class=\"token punctuation\">-</span>$DOCKERIZE_VERSION.tar.gz \\\n    &amp;&amp; tar <span class=\"token punctuation\">-</span>C /usr/local/bin <span class=\"token punctuation\">-</span>xzvf dockerize<span class=\"token punctuation\">-</span>linux<span class=\"token punctuation\">-</span>amd64<span class=\"token punctuation\">-</span>$DOCKERIZE_VERSION.tar.gz\n\n<span class=\"token keyword\">RUN</span> npm install <span class=\"token punctuation\">-</span>g nodemon\n<span class=\"token keyword\">RUN</span> mkdir <span class=\"token punctuation\">-</span>p /usr/src/app\n<span class=\"token keyword\">WORKDIR</span> /usr/src/app\n\n<span class=\"token keyword\">COPY</span> package*.json ./\n<span class=\"token keyword\">RUN</span> npm install\n\n<span class=\"token keyword\">COPY</span> . .\n\n<span class=\"token keyword\">RUN</span> chmod +x docker<span class=\"token punctuation\">-</span>entrypoint.sh\n<span class=\"token keyword\">ENTRYPOINT</span> ./docker<span class=\"token punctuation\">-</span>entrypoint.sh\n\n<span class=\"token keyword\">EXPOSE</span> 8080</code></pre></div>\n<h2 id=\"4-2-docker-entrypointsh\" style=\"position:relative;\"><a href=\"#4-2-docker-entrypointsh\" aria-label=\"4 2 docker entrypointsh permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-2. docker-entrypoint.sh</h2>\n<p>Shell script using dockerize installed in Dockerfile above. It waits until the 3306 port of the db container is connected through the installed dockerize module, i.e., until the db container is ready for operation, and then runs the operation server.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># docker-entrypoint.sh for node.js</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"wait db server\"</span>\ndockerize -wait tcp://db:3306 -timeout 20s\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"start node server\"</span>\nnodemon index.js</code></pre></div>\n<h2 id=\"4-3-dockerignore\" style=\"position:relative;\"><a href=\"#4-3-dockerignore\" aria-label=\"4 3 dockerignore permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-3. .dockerignore</h2>\n<p>Specify a folder or file that should not be copied to the docker container.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># .dockerignore for node.js</span>\n\n.gitignore\n/node_modules</code></pre></div>\n<h2 id=\"4-4-indexjs\" style=\"position:relative;\"><a href=\"#4-4-indexjs\" aria-label=\"4 4 indexjs permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-4. index.js</h2>\n<p>The node.js file to run in the node.js docker container. The mysql2 module shall be installed.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save mysql2</code></pre></div>\n<p>The code was written to determine whether mysql's connection was properly processed. The value of the host below can be changed arbitrarily by changing the name of the db container in docker-compose.yml, and the password value can be changed arbitrarily by changing the value of MYSQL<em>ROOT</em>PASSWORD in docker-compose.yml above.\nThe database can also be changed by arbitrarily modifying init.sql in the MySQL part below.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// index.js</span>\n\n<span class=\"token keyword\">const</span> mysql <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql2/promise\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">dbConnect</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> mysql<span class=\"token punctuation\">.</span><span class=\"token function\">createConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            host<span class=\"token operator\">:</span> <span class=\"token string\">\"db\"</span><span class=\"token punctuation\">,</span>\n            user<span class=\"token operator\">:</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n            password<span class=\"token operator\">:</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n            database<span class=\"token operator\">:</span> <span class=\"token string\">\"SampleDB\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql connection success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">dbConnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"5-mysql\" style=\"position:relative;\"><a href=\"#5-mysql\" aria-label=\"5 mysql permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. MySQL</h1>\n<p>Since mysql does not have many separate files, I will only explain init.sql for initialization. The DB was named SampleDB and the character scheme was utf8.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> SampleDB <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8mb4 <span class=\"token keyword\">COLLATE</span> utf8mb4_unicode_ci<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">USE</span> SampleDB<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">User</span> <span class=\"token punctuation\">(</span>\n    id <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n    name <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"github\" style=\"position:relative;\"><a href=\"#github\" aria-label=\"github permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[GitHub]</h1>\n<ul>\n<li><a href=\"https://github.com/millo-L/nodejs-mysql-dockerize\">https://github.com/millo-L/nodejs-mysql-dockerize</a></li>\n</ul>\n<h1 id=\"referebces\" style=\"position:relative;\"><a href=\"#referebces\" aria-label=\"referebces permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[Referebces]</h1>\n<ul>\n<li><a href=\"https://docs.docker.com/compose/\">https://docs.docker.com/compose/</a></li>\n<li><a href=\"https://jupiny.com/2016/11/13/conrtrol-container-startup-order-in-compose/\">https://jupiny.com/2016/11/13/conrtrol-container-startup-order-in-compose/</a></li>\n<li><a href=\"https://odysseyj.tistory.com/46\">https://odysseyj.tistory.com/46</a></li>\n</ul>","id":"9d08ddee-671c-55e7-acce-4ff5426548ae","tableOfContents":"<ul>\n<li><a href=\"#1-introduction\">1. Introduction</a></li>\n<li><a href=\"#2-folder-structure\">2. Folder Structure</a></li>\n<li><a href=\"#3-docker-composeyml\">3. docker-compose.yml</a></li>\n<li>\n<p><a href=\"#4-nodejs\">4. node.js</a></p>\n<ul>\n<li><a href=\"#4-1-dockerfile\">4-1. Dockerfile</a></li>\n<li><a href=\"#4-2-docker-entrypointsh\">4-2. docker-entrypoint.sh</a></li>\n<li><a href=\"#4-3-dockerignore\">4-3. .dockerignore</a></li>\n<li><a href=\"#4-4-indexjs\">4-4. index.js</a></li>\n</ul>\n</li>\n<li><a href=\"#5-mysql\">5. MySQL</a></li>\n<li><a href=\"#github\">GitHub</a></li>\n<li><a href=\"#referebces\">Referebces</a></li>\n</ul>","frontmatter":{"author":"millo","description":"In docker-compose, use dockerize to synchronize the run order of node.js and mysql.","category":"docker","released_at":"2021-03-05 17:00","updated_at":null,"tags":["docker","mysql","node.js","docker-compose"],"title":"[Docker] Synchronize docker-compose (node.js, mysql) execution order","lang":"en","series":"none","translation":"/docker-compose-nodejs-mysql-ì‹¤í–‰-ìˆœì„œ-ë™ê¸°í™”/","image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQ0lEQVR42oWSTWgTQRTH324yM7tpUxVFsZCD0IMo9KAni1RBD4qCt4LFi1IUS7KxNJgmpCRaTbQJVg9+JBqjMV9E0KoJrRht2kgVjTZF0R6kB0XaBguCF62149uthxKJDvyYeTPv/XkfA1CxWPdjYO48UFdOqI1+A+YZAahbK1DnwybqGDQScwxqX3G0BwXmKcB/Fz3+ADBQoPYskGNpiboeNdPuJ23s1PMf7ERhneR/A/WcA3PlwBCa0WKIJVFFzBIHausXyJEw6Pd1UerOOyVfkUveF5x5X85jlq2sZ7SFnRkLMFt/DbVnxEYU/4dgAuTgtCAFp4B6Rmxyb4mzs6WfxPd6QVLPvuIc6x3PSn0TnLmH/fKFDyBf+iRWFVQf6jgXVv3iIPdNFCA4y+XQzPc1kel5EirPyeHZBeniRxTLt0jn3kNNjgPtvFM9Q72SBGNgXAfeMdCdfGZtuDbJ9w+UuSla5vrQF47ZqKWfliNfFyvquI09v199INoErTERGp3AsTf+bLEz8/bz042RyVHB/+66wT20x3APsw9OidgeHWm/Ub1UYs9ogupgdOb4itWOu8uORoc1YSghO9tXUscA6A8EFv3VAaI/a7sCDIdIlESFID5qWOKbEQdiMXakdi23pZtEJbWbWlM9VElux/u9SCtyEGnWfgbylyBVNCg6mf9wGTmEzrfwfiv63ES7CwkjKbTPE0uMESUpqJlWCMaXsh7ZggEm3Lch9cgODGjAO/W8CfcNaJtYRxrEw1dBv0TwN/rEAHAFk3mbAAAAAElFTkSuQmCC","aspectRatio":1.7857142857142858,"src":"/static/bb8e5ba3597380023a854295c990e919/ee604/docker.png","srcSet":"/static/bb8e5ba3597380023a854295c990e919/69585/docker.png 200w,\n/static/bb8e5ba3597380023a854295c990e919/497c6/docker.png 400w,\n/static/bb8e5ba3597380023a854295c990e919/ee604/docker.png 800w,\n/static/bb8e5ba3597380023a854295c990e919/db955/docker.png 900w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"fields":{"slug":"/Synchronize-docker-compose-nodejs-mysql-execution-order/"}},"site":{"siteMetadata":{"siteUrl":"https://millo-L.github.io"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"[Docker] docker-compose (node.js, mysql) ì‹¤í–‰ ìˆœì„œ ë™ê¸°í™”","lang":"ko"},"fields":{"slug":"/docker-compose-nodejs-mysql-ì‹¤í–‰-ìˆœì„œ-ë™ê¸°í™”/"}}},{"node":{"frontmatter":{"title":"[JavaScript] Callback ì§€ì˜¥ ë²—ì–´ë‚˜ê¸°","lang":"ko"},"fields":{"slug":"/JavaScript-Callback-ì§€ì˜¥-ë²—ì–´ë‚˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Docker] Jenkins in Docker(Ubuntu18.04)","lang":"ko"},"fields":{"slug":"/Jenkins-in-Docker-Ubuntu1804/"}}},{"node":{"frontmatter":{"title":"[Go] êµ¬ì¡°ì²´ë¥¼ Classì²˜ëŸ¼ ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Goì–¸ì–´ì—ì„œ-êµ¬ì¡°ì²´ë¥¼-Classì²˜ëŸ¼-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Raspberry pi] OpenCV4 ì„¤ì¹˜í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Raspberry-piì—-OpenCV4-ì„¤ì¹˜í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Python] ê°„ë‹¨í•œ Anaconda ê°€ìƒ í™˜ê²½ ê´€ë¦¬í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Python-ê°„ë‹¨í•œ-Anaconda-ê°€ìƒ-í™˜ê²½-ê´€ë¦¬í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Python] TCP image socket êµ¬í˜„í•˜ê¸°(Server, Client)","lang":"ko"},"fields":{"slug":"/Python-TCP-image-socket-êµ¬í˜„í•˜ê¸°-Server-Client/"}}},{"node":{"frontmatter":{"title":"[Node.js] express ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-express-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] express router ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-express-router-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Raspberry pi] ë¶€íŒ… ì‹œ í”„ë¡œê·¸ë¨ ìë™ ì‹¤í–‰í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Raspberry-pi-ë¶€íŒ…ì‹œ-í”„ë¡œê·¸ë¨-ìë™-ì‹¤í–‰í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] moment ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-moment-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Docker] Ubuntu:18.04ì—ì„œ Docker ì„¤ì¹˜í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Ubuntu-1804ì—ì„œ-Docker-ì„¤ì¹˜í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[NGINX] Ubuntu:18.04ì—ì„œ letsencrypt HTTPS í™˜ê²½ êµ¬ì¶•í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Ubuntu-1804ì—ì„œ-letsencrypt-HTTPS-í™˜ê²½êµ¬ì¶•/"}}},{"node":{"frontmatter":{"title":"[Node.js] nodemailer ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-nodemailer-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] mysqlì„ async/awaitë¡œ ì²˜ë¦¬í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-mysqlì„-async-awiatë¡œ-ì²˜ë¦¬í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] express cors ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-express-cors-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] express static folder ì§€ì •í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-express-static-folder-ì§€ì •í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[JavaScript] Date ê°ì²´ ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/JavaScript-Date-ê°ì²´-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Docker] ReactJS Dockerizingí•˜ê¸°","lang":"ko"},"fields":{"slug":"/React-Dockerizingí•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[React Native] ë°°ê²½ ì´ë¯¸ì§€ í¬ê¸° ìë™ìœ¼ë¡œ ë§ì¶”ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-ë°°ê²½-ì´ë¯¸ì§€-í¬ê¸°-ìë™ìœ¼ë¡œ-ë§ì¶”ê¸°/"}}},{"node":{"frontmatter":{"title":"[React Native] ì»¤ìŠ¤í…€ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í¬ë¦° êµ¬í˜„í•˜ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-ì»¤ìŠ¤í…€-ë¡œë”©-ì• ë‹ˆë©”ì´ì…˜-ìŠ¤í¬ë¦°-êµ¬í˜„í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] Socket.io ê°„ë‹¨í•œ ì±„íŒ… êµ¬í˜„í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-socketio-ê°„ë‹¨í•œ-ì±„íŒ…-êµ¬í˜„í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Python] Ubuntu:18.04 ì—ì„œ jupyter notebook ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Python-Ubuntu1804ì—ì„œ-jupyter-notebook-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Network] HTTP ìƒíƒœ(ì‘ë‹µ) ì½”ë“œ ì •ë¦¬í•˜ê¸°","lang":"ko"},"fields":{"slug":"/HTTP-ìƒíƒœì½”ë“œ-ì •ë¦¬í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Network] SOAP ì •ë¦¬í•˜ê¸°","lang":"ko"},"fields":{"slug":"/SOAP-ì •ë¦¬í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] slack ì—°ë™í•˜ê¸°(ì•Œë¦¼ë´‡ êµ¬í˜„)","lang":"ko"},"fields":{"slug":"/Nodejs-slack-ì—°ë™í•˜ê¸°-ì•Œë¦¼ë´‡êµ¬í˜„/"}}},{"node":{"frontmatter":{"title":"[React Native] Dimensions.get('window')ì™€ Dimensions.get('screen')ì˜ ì°¨ì´ì ","lang":"ko"},"fields":{"slug":"/ReactNative-Dimensions-get-windowì™€-Dimentsions-get-screenì˜-ì°¨ì´ì /"}}},{"node":{"frontmatter":{"title":"[React Native] Bottom tab bar íŠ¹ì • í™”ë©´ì—ì„œ ì•ˆ ë³´ì´ê²Œ ì„¤ì •í•˜ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-Bottom-tab-bar-íŠ¹ì •-í™”ë©´ì—ì„œ-ì•ˆ-ë³´ì´ê²Œ-ì„¤ì •í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[React Native] íŠ¹ì • í™”ë©´ì—ì„œ í™”ë©´ ê³ ì •í•˜ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-íŠ¹ì •-í™”ë©´ì—ì„œ-í™”ë©´-ê³ ì •í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Node.js] PBKDF2 ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Nodejs-PBKDF2-ë¹„ë°€ë²ˆí˜¸-ì•”í˜¸í™”í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Network] HTTPë€ ë¬´ì—‡ì¸ê°€","lang":"ko"},"fields":{"slug":"/HTTPë€-ë¬´ì—‡ì¸ê°€/"}}},{"node":{"frontmatter":{"title":"[Network] URIì™€ URLì˜ ì°¨ì´ì ","lang":"ko"},"fields":{"slug":"/URIì™€-URLì˜-ì°¨ì´ì /"}}},{"node":{"frontmatter":{"title":"[Gatsby] document is not defined build error í•´ê²° ë°©ë²•","lang":"ko"},"fields":{"slug":"/Gatsby-build-error-document-is-not-defined-í•´ê²°ë°©ë²•/"}}},{"node":{"frontmatter":{"title":"[Gatsby] Troubleshooting document is not defined build error","lang":"en"},"fields":{"slug":"/Troubleshooting-Gatsby-build-error-document-is-not-defined/"}}},{"node":{"frontmatter":{"title":"[Typescript] mongoose methods, statics ì‚¬ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/Typescript-mongodb-method-statics-ì‚¬ìš©í•˜ê¸°/"}}},{"node":{"frontmatter":{"title":"[Typescript] mongoose methods, statics","lang":"en"},"fields":{"slug":"/Typescript-mongoose-methods-statics/"}}},{"node":{"frontmatter":{"title":"[Network] Differences between URI and URL","lang":"en"},"fields":{"slug":"/Difference-between-URI-and-URL/"}}},{"node":{"frontmatter":{"title":"[Docker] Synchronize docker-compose (node.js, mysql) execution order","lang":"en"},"fields":{"slug":"/Synchronize-docker-compose-nodejs-mysql-execution-order/"}}},{"node":{"frontmatter":{"title":"[JavaScript] Get out of Callback hell","lang":"en"},"fields":{"slug":"/JavaScript-Get-out-of-Callback-hell/"}}},{"node":{"frontmatter":{"title":"[Docker] Jenkins in Docker(Ubuntu18.04)","lang":"en"},"fields":{"slug":"/jenkins-in-docker-ubuntu/"}}},{"node":{"frontmatter":{"title":"[Go] Using Struct as Class","lang":"en"},"fields":{"slug":"/Using-struct-as-class-in-golang/"}}},{"node":{"frontmatter":{"title":"Install Opencv 4 on Raspberry Pi 4","lang":"en"},"fields":{"slug":"/Install-Opencv-4-on-Raspberry-Pi-4/"}}},{"node":{"frontmatter":{"title":"[Python] Manage simple Anaconda virtual environmentsê¸°","lang":"en"},"fields":{"slug":"/Python-Manage-simple-Anaconda-virtual-environments/"}}},{"node":{"frontmatter":{"title":"[Python] Implementing TCP image socket(Server, Client)","lang":"en"},"fields":{"slug":"/Python-Implementing TCP image socket-Server-Client/"}}},{"node":{"frontmatter":{"title":"[Node.js] Use express","lang":"en"},"fields":{"slug":"/Nodejs-use-expressjs/"}}},{"node":{"frontmatter":{"title":"ìŠ¤íƒ€íŠ¸ì—… ì½”ë”© í˜ìŠ¤í‹°ë²Œ 2021 1ì°¨, 2ì°¨ í›„ê¸°","lang":"ko"},"fields":{"slug":"/scope-2021/"}}},{"node":{"frontmatter":{"title":"[React Native] ë‹¤ë¥¸ ì•±(play store, instagram ë“±) ì—´ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-link-other-app/"}}},{"node":{"frontmatter":{"title":"[React Native] Firebase Analytics(@react-native-firebase/analytics) ì ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-Firebase-Analytics-Setting/"}}},{"node":{"frontmatter":{"title":"[React Native] Facebook SDK(react-native-fbsdk) ì ìš©í•˜ê¸°","lang":"ko"},"fields":{"slug":"/ReactNative-facebook-sdk-setting/"}}},{"node":{"frontmatter":{"title":"[React Native] ld: symbol(s) not found for architecture x86_64 í•´ê²°ë°©ë²•","lang":"ko"},"fields":{"slug":"/ReactNative-ld-symbols-not-found-error/"}}},{"node":{"frontmatter":{"title":"[Android] Debug ë²„ì „ìœ¼ë¡œëŠ” ì‹¤í–‰ë˜ëŠ” ë° Release Crash ë‚˜ëŠ” ê²½ìš°","lang":"ko"},"fields":{"slug":"/Android-release-error/"}}},{"node":{"frontmatter":{"title":"[React Native] CodePushë¥¼ ì´ìš©í•œ ì•± ì—…ë°ì´íŠ¸","lang":"ko"},"fields":{"slug":"/ReactNative-codepush/"}}},{"node":{"frontmatter":{"title":"[React Native] Troubleshooting ld: symbol(s) not found for architecture x86_64","lang":"en"},"fields":{"slug":"/ReactNative-ld-symbols-not-found-error-en/"}}},{"node":{"frontmatter":{"title":"[Android] Runs with Debug version, but fails with Release version","lang":"en"},"fields":{"slug":"/Android-release-error-en/"}}},{"node":{"frontmatter":{"title":"[React Native] Kakao Linkë¥¼ ì‚¬ìš©í•´ì„œ Deep linkë¥¼ êµ¬í˜„í•´ë³´ì.","lang":"ko"},"fields":{"slug":"/ReactNative-kakao-deep-link/"}}},{"node":{"frontmatter":{"title":"[React Native] @react-native-firebase ì ìš©í•˜ê¸° (pod install ì—ëŸ¬ í•´ê²°)","lang":"ko"},"fields":{"slug":"/ReactNative-Firebase-2023-05-25/"}}},{"node":{"frontmatter":{"title":"[React Native] Install @react-native-firebase (solve pod install issue)","lang":"en"},"fields":{"slug":"/ReactNative-Firebase-2023-05-25-en/"}}}]}},"pageContext":{"slug":"/Synchronize-docker-compose-nodejs-mysql-execution-order/","series":"none"}},"staticQueryHashes":["1608878238","3469517283","764694655"]}