{"componentChunkName":"component---src-components-post-post-template-tsx","path":"/Nodejs-passport-Google-OAuth-2-로그인-사용하기/","result":{"data":{"markdownRemark":{"html":"<h2 id=\"1-서론\" style=\"position:relative;\"><a href=\"#1-%EC%84%9C%EB%A1%A0\" aria-label=\"1 서론 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 서론</h2>\n<p>지난 포스팅에서 OAuth 2.0이 무엇이고 종류에 따른 인증 방식에 대해 알아봤다. 그럼 실제로 node.js에서 OAuth 2.0을 통한 구글 로그인을 구현해보도록 하자. 이 포스팅에서 구글 로그인을 구현할 때 사용할 모듈은 passport로 passport로 session을 관리하는 부분이 포함되기 때문에 만약 잘 모르는 부분이라면 이 포스팅을 참고하기 바란다.</p>\n<h2 id=\"2-google-developers-console에서-oauth-20-클라이언트-생성\" style=\"position:relative;\"><a href=\"#2-google-developers-console%EC%97%90%EC%84%9C-oauth-20-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-label=\"2 google developers console에서 oauth 20 클라이언트 생성 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Google Developers Console에서 OAuth 2.0 클라이언트 생성</h2>\n<p><a href=\"https://console.developers.google.com/apis\">https://console.developers.google.com/apis</a> 에 접속해서client ID와 client secret를 발급받아야 한다. 아래의 그림 1과 같이 OAuth 클라이언트 ID를 생성한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1046px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9586e26e57913ac04eeeff669281d30/21b4d/google-oauth1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.48854961832062%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsUlEQVR42u1U247bIBDl/z+qP1Cpj02jStlNbAO+ch3u2Dt2k1X2MarUpx6jkcCcc5hhBJFCKq3mee6H8dq0t5Y1Lb023bXBSG8d48PU0r5lA+3HhvcdGxvG31v6zjlxYFJy3mvvwTmDMQYLAXwI1sGiVUoVwIUQcs02uRQTJOCz/X5WZHcWcoeQAOC9l0KIflDDaKdJK6s06jzgQ0opp9By9e2HJMhahLAApRQHIJTSvFc/f4vTRZ8uhg8h51wKjpTzzjymiBATQTnnYF3XbdvQ1lgbtJaXN3G76bZzjB+D2Y5m3m+1bg+UWonQkfZa6BTLZq3V1mY8zPnMT7/srQmU+Y5C08Z+KJTlEA7rOwgWQEoVY0IxPIXGFH0wxszTtMwz5g8oaUz0Hs9cHqi1YiQpRQAb007GbcsijNHo3XXdMI6MMaXUvMyUUVRMaHKkHUOIMRIUWA/cczZ4Wx6n+G+PIWJ50AUX86NgSBHSWHCkPtXAOSeWxXn3Z8c9Yhs4V56A6+Azyn4hoxveJH7P6X2qPGPdU/5KfglI/E/+p+TPDnsVe2//lTM+G9j68DqMMR9ZrMiTFZ94lwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google oauth1\"\n        title=\"\"\n        src=\"/static/b9586e26e57913ac04eeeff669281d30/1c1a4/google-oauth1.png\"\n        srcset=\"/static/b9586e26e57913ac04eeeff669281d30/8ff13/google-oauth1.png 262w,\n/static/b9586e26e57913ac04eeeff669281d30/3e286/google-oauth1.png 523w,\n/static/b9586e26e57913ac04eeeff669281d30/1c1a4/google-oauth1.png 1046w,\n/static/b9586e26e57913ac04eeeff669281d30/21b4d/google-oauth1.png 1280w\"\n        sizes=\"(max-width: 1046px) 100vw, 1046px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>아래의 그림2와 같이 애플리케이션 유형을 웹 애플리케이션으로 설정하고, 이름은 임의로 수정 가능하다. URI는 실습을 수행하기 위해 아래와 같이 사용하고, 실습을 마친 후에 원하는 URI로 수정하기 바란다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1046px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1c2873516ea21704c599972f1f250c49/a3a5c/google-oauth2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.87022900763358%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACAElEQVR42pVS2W7bMBDU/39Mf6HoSx/6YhQGijopbMkWRYnUwfsm1bVroykS18lgKGgJznJ2uRVnTEhOKR0orY/tCWHgse0uxPvmdGrx4YgOTdtAeGqbE2rQ5YeQSmsZgnFGWqOMUc4qb5WxWhttjKHLbF2AAKKQgvQ6uKCC6mf5bSerZWEMFhhYmNbaGrtcQimkllIpw6Vx/grnXIwxeDdQ+XkjQHwGyFJKLkQuBeN8ZgxspFIi7OYUQHBDvAC2Q8wVJAN7pZR1XeeBtvvD2KEJoRF1E8YT7inqnbbrK4CiWoTvBjHL6LmiP3b15rtsTr6ncSCRkEip73DA/fX4v6i8D4xxH9PKuNhs2Harfz7r3T7tD2ce6vj0nOrmrtho7WNYrVUtGutaYqwwNsPgxtGN1BGSOV/fQgWlX5KesxprhwvGaaKToBMnk6QjC8H/T/wHPgShFJcSssSUoachZehvzvmx2EgppskK4YRcQ7gyxvUO/oqLEPrp2XZdxDgTmvrhzIGkY1vcQ9vOKUxYP0YuslJZ3gjdeuHurm0XgrLWOHevyPviUjQ8EkLQ8TTNeVmunJfHN5dxNHWtlkURKghx85KkStpEQot1j2/miLJjD52DOuFbhCxcFKUf2D6PiNNfPm22X3+9NYjvqDnnch6113wsvg3p+1HFFwP0UfFvW43C8BMd86wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google oauth2\"\n        title=\"\"\n        src=\"/static/1c2873516ea21704c599972f1f250c49/1c1a4/google-oauth2.png\"\n        srcset=\"/static/1c2873516ea21704c599972f1f250c49/8ff13/google-oauth2.png 262w,\n/static/1c2873516ea21704c599972f1f250c49/3e286/google-oauth2.png 523w,\n/static/1c2873516ea21704c599972f1f250c49/1c1a4/google-oauth2.png 1046w,\n/static/1c2873516ea21704c599972f1f250c49/a3a5c/google-oauth2.png 1277w\"\n        sizes=\"(max-width: 1046px) 100vw, 1046px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>아래의 그림3과 같이 생성된 클라이언트 ID와 보안 비밀번호를 각각 복사해둔다. 만약 이 페이지를 실수로 넘어갔다면 OAuth 2.0 클라이언트 ID 부분에서 생성된 이름을 클릭하면 다시 볼 수 있는 화면이 나온다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1046px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9f93d3ad78f7b3e9159084bb3499899c/21b4d/google-oauth3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.48854961832062%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZElEQVR42o1U227aQBD1l/etD/mCSq2KDb7g9QVUIJS3SHmoqqZJAxiHPLSpEvB6fYkN2JBUpPTYG6XkoiRH1npmPWdmzl4s5Fm2XOazWXqZJFPKKAspCyZ+YUxpcO75PosmNJh4zGMh5j0aeEE4YeF5GAmuMxyPHdfpj0bOyBm4o+GJOxiO4I76g8HB0eGJO+73+87Qcccnx+7Add1jt//taNjbHwiiKIkVsRhFUZZlRVFKR6pWq3INUKSqrN5BUbQ6oL17L73ZkQREg4Mpy7IwXdiaRoihqESrG5gx4GzBLGHZFgaBEIII27YbjUa9riO5XgIp4Gp10zAsfLIfAcUEWSUfKmpNIcS0QUBjyI4PpASvg1wYjUcQEIpWdUJQG0FcBdQVyjTtrgvOvwOyYwTZKEQaBL3BwBK1W612u93pdLrd7u7u7udeD0brU2tbNnIVlZGDCwBZVooFjqKIMR+glMZxfHNzs16v8zwvRKkqp4mVCgTekvmC8bZBuEzSdJ7N5nM8WZYv81W2yMyyZtmwpWqGTox7ZGSu1mpJHMVBNL2gke/FzIs9mnhBms74EvLO+fs/GUDKpm2dsmTvd/zdz7/6q31vuU+XXybz6OdZoW0ruNiqbR971Glae2fx28Nw50fcvVj9ml276Z/TIIsOjtDvc+TCNs04v6bXm+nVZrHeAH+LYXOVpBD88JA8IEMLo97iMprFYRyFfhCyIAzCaOL5EPkcuZRtipL0sVLBsw3cmxcqczSfQqPZfOJsPya/Ek+Qrfv78QKZHw8OWLdNvgIgCrg9/OjwC8R/GOQV0HX9H9x6iHEDDtpkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google oauth3\"\n        title=\"\"\n        src=\"/static/9f93d3ad78f7b3e9159084bb3499899c/1c1a4/google-oauth3.png\"\n        srcset=\"/static/9f93d3ad78f7b3e9159084bb3499899c/8ff13/google-oauth3.png 262w,\n/static/9f93d3ad78f7b3e9159084bb3499899c/3e286/google-oauth3.png 523w,\n/static/9f93d3ad78f7b3e9159084bb3499899c/1c1a4/google-oauth3.png 1046w,\n/static/9f93d3ad78f7b3e9159084bb3499899c/21b4d/google-oauth3.png 1280w\"\n        sizes=\"(max-width: 1046px) 100vw, 1046px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"3-환경-설정\" style=\"position:relative;\"><a href=\"#3-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"3 환경 설정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 환경 설정</h2>\n<blockquote>\n<p><strong>전제 조건</strong> <br/>\nNode.js는 당연히 설치되어 있어야 한다. <br/>\nMySQL로 DB Session을 구현할 것이므로 MySQL을 설치하기 바란다. <br/>\n당연히 MySQL은 RDS나 Docker 등의 원격 DB로 대체 가능하다.</p>\n</blockquote>\n<p>하지만 MySQL을 사용하길 원치 않는 사람이 있다면, 이 포스팅을 방문해 memory store 또는 file store를 적용해도 무방하다. 세션 부분만 변경하면 되기 때문에 어려움 없이 대체 가능하다.\n우선, 실습을 진행할 폴더를 생성하고 필요한 모듈을 설치하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\">## 폴더 생성 및 열기</span>\n<span class=\"token function\">mkdir</span> passport-google-practice\n<span class=\"token builtin class-name\">cd</span> passport-google-practice\n\n<span class=\"token comment\">## package.json 생성</span>\n<span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span>\n\n<span class=\"token comment\">## 필요한 모듈 설치</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> http express express-session express-mysql-session passport passport-google-oauth2\n `<span class=\"token variable\"><span class=\"token variable\">`</span>\n\nMySQL을 사용하는 경우 실습에 사용할 데이터 베이스를 아래의 명령어를 사용하여 생성하도록 하자. <span class=\"token punctuation\">(</span>MySQL 대신 memory store 또는 <span class=\"token function\">file</span> store를 사용한다면 이 부분은 지나가도 된다.<span class=\"token punctuation\">)</span>\n<span class=\"token variable\">`</span></span>``sql\n<span class=\"token comment\">## MySQL Command Line Client</span>\nCREATE DATABASE session_test<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>구글 로그인 버튼 이미지를 <a href=\"https://developers.google.com/identity/images/signin-assets.zip?hl=ko\">파일 다운로드</a>를 눌러 다운로드 받도록 하자. 이 포스팅에서는 다운로드 받은 이미지 파일들 중 /web/2x/btn_<a href=\"mailto:google_signin_dark_normal_web@2x.png\">google_signin_dark_normal_web@2x.png</a>를 사용한다.\n(사실, 실습에서는 원하는 이미지 아무거나 사용해도 무방하다. 다만, 실제 서비스에서는 <a href=\"https://developers.google.com/identity/branding-guidelines?hl=ko\">https://developers.google.com/identity/branding-guidelines?hl=ko</a> 를 방문해서 가이드라인을 반드시 준수해야 한다.)</p>\n<h2 id=\"4-폴더-구조\" style=\"position:relative;\"><a href=\"#4-%ED%8F%B4%EB%8D%94-%EA%B5%AC%EC%A1%B0\" aria-label=\"4 폴더 구조 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 폴더 구조</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">📦passport-google-practice\n ┣ 📂node_modules\n ┣ 📂public\n ┃ ┗ 📂images\n ┃ ┃ ┗ 📜btn_google_signin_dark_normal_web@2x.png\n ┣ 📂webpage\n ┃ ┣ 📜login.html\n ┃ ┗ 📜main.html\n ┣ 📜google.js\n ┣ 📜package-lock.json\n ┗ 📜package.json</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"5-loginhtml\" style=\"position:relative;\"><a href=\"#5-loginhtml\" aria-label=\"5 loginhtml permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. login.html</h2>\n<p>로그인을 진행할 간단한 html 파일을 작성해보자. 페이지에는 구글 로그인과 연동할 버튼만 존재한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- login.html --></span>\n\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>login<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n            <span class=\"token selector\">#google_login_btn</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"/images/btn_google_signin_dark_normal_web@2x.png\"</span><span class=\"token punctuation\">)</span></span>\n                    no-repeat<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% 100%<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 200px<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 50px<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>GET<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/auth/google<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>google_login_btn<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"6-mainhtml\" style=\"position:relative;\"><a href=\"#6-mainhtml\" aria-label=\"6 mainhtml permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. main.html</h2>\n<p>로그인이 성공했을 때의 html 파일을 작성햏보자. 간단하게 logout 링크 기능만 존재하고 해당 링크를 클릭 시에 세션 정보가 삭제되어 다시 로그인을 진행해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- main.html --></span>\n\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Main<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Main page<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/logout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>logout<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"7-googlejs\" style=\"position:relative;\"><a href=\"#7-googlejs\" aria-label=\"7 googlejs permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. google.js</h2>\n<p>passport 초기화와 session에 대한 설명은 지난 포스팅을 참고하기 바란다. 아래에서 주석으로 설명을 다 적어놓긴 했지만, flow을 작성해본다면,</p>\n<ol>\n<li>사용자가 <a href=\"http://localhost:8080/login\">http://localhost:8080/login</a> 으로 접속한다.</li>\n<li>구글 로그인 버튼을 클릭한다. (<a href=\"http://localhost:8080/auth/google\">http://localhost:8080/auth/google</a> 호출)</li>\n<li>생성한 GoogleStrategy 설정에 따른 로그인 페이지를 제공한다.</li>\n<li>구글 로그인 페이지에서 아이디, 비밀번호를 입력 후 확인 버튼을 누른다.</li>\n<li>로그인 성공 시 GoogleStrategy 내의 콜백 함수로 파라미터들을 넘겨받고 <a href=\"http://localhost:8080/auth/google/callback%EC%97%90\">http://localhost:8080/auth/google/callback에</a> 의해 <a href=\"http://localhost:8080\">http://localhost:8080</a> 페이지로 리다이렉트 된다.</li>\n<li>로그인 실패 시 <a href=\"http://localhost:8080/auth/google/callback%EC%97%90\">http://localhost:8080/auth/google/callback에</a> 의해 <a href=\"http://localhost:8080/login\">http://localhost:8080/login</a> 페이지로 리다이렉트 된다.</li>\n</ol>\n<p>passport 모듈 자체가 워낙 잘 만들어져 있어서 구현하는 데 큰 어려움은 없었다. 플로우만 이해한다면 어디든 사용할 수 있을 것이다. 추가적으로 facebook 로그인 등도 passport에서 지원하니 웹 페이지를 만들 때는 참고해서 사용하면 좋을 것 같다. 하지만, Android, IOS 등의 애플리케이션에서는 passport의 기능을 사용할 수 없으니 자체적으로 구현하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// google.js</span>\n\n<span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> session <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express-session\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> MySQLStore <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express-mysql-session\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> passport <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"passport\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> GoogleStrategy <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"passport-google-oauth2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 위의 Google Developers Console에서 생성한 client id와 secret</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GOOGLE_CLIENT_ID</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"your_google_client_id\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GOOGLE_CLIENT_SECRET</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"your_google_client_secret\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// db session store options</span>\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token number\">3306</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">database</span><span class=\"token operator\">:</span> <span class=\"token string\">\"session_test\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// mysql session store 생성</span>\n<span class=\"token keyword\">const</span> sessionStore <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MySQLStore</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// express session 연결</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">session</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">secret</span><span class=\"token operator\">:</span> <span class=\"token string\">\"secret key\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">store</span><span class=\"token operator\">:</span> sessionStore<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">resave</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">saveUninitialized</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// image 사용을 위한 static folder 지정</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"public\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// passport 초기화 및 session 연결</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>passport<span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>passport<span class=\"token punctuation\">.</span><span class=\"token function\">session</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// login이 최초로 성공했을 때만 호출되는 함수</span>\n<span class=\"token comment\">// done(null, user.id)로 세션을 초기화 한다.</span>\npassport<span class=\"token punctuation\">.</span><span class=\"token function\">serializeUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 사용자가 페이지를 방문할 때마다 호출되는 함수</span>\n<span class=\"token comment\">// done(null, id)로 사용자의 정보를 각 request의 user 변수에 넣어준다.</span>\npassport<span class=\"token punctuation\">.</span><span class=\"token function\">deserializeUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Google login 전략</span>\n<span class=\"token comment\">// 로그인 성공 시 callback으로 request, accessToken, refreshToken, profile 등이 나온다.</span>\n<span class=\"token comment\">// 해당 콜백 function에서 사용자가 누구인지 done(null, user) 형식으로 넣으면 된다.</span>\n<span class=\"token comment\">// 이 예시에서는 넘겨받은 profile을 전달하는 것으로 대체했다.</span>\npassport<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">GoogleStrategy</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">clientID</span><span class=\"token operator\">:</span> <span class=\"token constant\">GOOGLE_CLIENT_ID</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">clientSecret</span><span class=\"token operator\">:</span> <span class=\"token constant\">GOOGLE_CLIENT_SECRET</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">callbackURL</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:8080/auth/google/callback\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">passReqToCallback</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> accessToken<span class=\"token punctuation\">,</span> refreshToken<span class=\"token punctuation\">,</span> profile<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>profile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> profile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// login 화면</span>\n<span class=\"token comment\">// 이미 로그인한 회원이라면(session 정보가 존재한다면) main화면으로 리다이렉트</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./webpage/login.html\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text/html\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// login 화면</span>\n<span class=\"token comment\">// 로그인 하지 않은 회원이라면(session 정보가 존재하지 않는다면) login화면으로 리다이렉트</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>req<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./webpage/main.html\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text/html\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// google login 화면</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/auth/google\"</span><span class=\"token punctuation\">,</span>\n    passport<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"google\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">scope</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"profile\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// google login 성공과 실패 리다이렉트</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"/auth/google/callback\"</span><span class=\"token punctuation\">,</span>\n    passport<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"google\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">successRedirect</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">failureRedirect</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// logout</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/logout\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    req<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Server running on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"목차\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[목차]</h2>\n<ul>\n<li><a href=\"https://developers.google.com/identity/protocols/oauth2\">https://developers.google.com/identity/protocols/oauth2</a></li>\n<li><a href=\"http://www.passportjs.org/packages/passport-google-oauth2/\">http://www.passportjs.org/packages/passport-google-oauth2/</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#1-%EC%84%9C%EB%A1%A0\">1. 서론</a></li>\n<li><a href=\"#2-google-developers-console%EC%97%90%EC%84%9C-oauth-20-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%83%9D%EC%84%B1\">2. Google Developers Console에서 OAuth 2.0 클라이언트 생성</a></li>\n<li><a href=\"#3-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\">3. 환경 설정</a></li>\n<li><a href=\"#4-%ED%8F%B4%EB%8D%94-%EA%B5%AC%EC%A1%B0\">4. 폴더 구조</a></li>\n<li><a href=\"#5-loginhtml\">5. login.html</a></li>\n<li><a href=\"#6-mainhtml\">6. main.html</a></li>\n<li><a href=\"#7-googlejs\">7. google.js</a></li>\n<li><a href=\"#%EB%AA%A9%EC%B0%A8\">[목차]</a></li>\n</ul>","frontmatter":{"author":"millo","category":"nodejs","description":"Node.js에서 Google OAuth 2.0로 로그인을 해보자.","image":{"childImageSharp":{"fixed":{"src":"/static/ddc3327468e331ff389407434bde7102/2244e/passport-google.jpg"}}},"lang":"ko","released_at":"2021-02-03 13:00","series":"Authentication 방식 정리하기","tags":["OAuth 2.0","nodejs","passport","passport-google-oauth2","google login"],"title":"[Node.js] passport Google OAuth 2.0 로그인 사용하기","translation":null,"updated_at":null},"fields":{"slug":"/Nodejs-passport-Google-OAuth-2-로그인-사용하기/"}},"allMarkdownRemark":{"nodes":[{"frontmatter":{"lang":"ko","title":"Session 기반 인증 방식"},"fields":{"slug":"/Session-기반-인증방식/"}},{"frontmatter":{"lang":"ko","title":"JWT 기반 인증 방식"},"fields":{"slug":"/JWT-기반-인증방식/"}},{"frontmatter":{"lang":"ko","title":"[Node.js] express session 사용하기"},"fields":{"slug":"/Nodejs-express-session-사용하기/"}},{"frontmatter":{"lang":"ko","title":"[Node.js] JWT 사용하기"},"fields":{"slug":"/Nodejs-JWT-사용하기/"}},{"frontmatter":{"lang":"ko","title":"[Node.js] passport session 사용하기"},"fields":{"slug":"/Nodejs-passport-session-사용하기/"}},{"frontmatter":{"lang":"ko","title":"OAuth 2.0 기반 인증 방식"},"fields":{"slug":"/OAuth2-기반-인증방식/"}},{"frontmatter":{"lang":"ko","title":"[Node.js] passport Google OAuth 2.0 로그인 사용하기"},"fields":{"slug":"/Nodejs-passport-Google-OAuth-2-로그인-사용하기/"}}]}},"pageContext":{"slug":"/Nodejs-passport-Google-OAuth-2-로그인-사용하기/","series":"Authentication 방식 정리하기","translation":null,"lang":"ko"}},"staticQueryHashes":["2083168511","3061319093","3557473807","356676075"],"slicesMap":{}}